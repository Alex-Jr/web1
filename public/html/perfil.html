<html>
    <head>
        <meta charset="utf-8">
        <title>Perfil</title>
        <!-- <link rel="stylesheet" href="perfil.css"> -->
        <!-- <script type="text/javascript" src="perfil.js"></script> -->

        <script type="text/javascript" src="loggedPage.js"></script>
        <script type="text/javascript" src="formulario.js"></script>
    
        <script>
            function deletarConta() {
                const xhttp = new XMLHttpRequest();
    
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        logout()
                    }
                };

                xhttp.open("DELETE", `usuarios`, true);
    
                xhttp.send();
            }

            function editar() {
                console.log('EDITAR');
                const xhttp = new XMLHttpRequest();
    
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4) {
                        switch(this.status) {
                            case 200:
                                alert('ok');
                            default:
                                document.getElementById('errogeral').innerHTML = this.responseText;
                                break
                        }
                    }
                    

                };

                xhttp.open("POST", 'perfil.html', true);

                let bodyRequest = ''

                const form = document.forms['formulario'];

                for (input of form) {
                    if(!input.name) continue;
                    bodyRequest += `${input.name}=${input.value}&`;
                }

                xhttp.send(bodyRequest);
            }
        </script>

    </head>
    <body>
        <a href="/home.html">
            <button name="voltarhome" class="botao">Voltar</button>
        </a>
        <h1>Editar Perfil</h1>
        <form id="formulario">
                <div class='campo' id="erronome">
                    <label for="nome">Nome:</label>
                    <input type="text" id="nome" name="nome">
                </div>

                <div class="campo" id="erroemail">
                    <label for="email">E-mail:</label>
                    <input type="text" id="email" name="email"><br>
                </div>

                <div class="campo" id="errodata">
                    <label for="datanasc">Nascimento:</label>
                    <input type="date" id="datanasc" name="datanasc">
                </div>

                <div class="campo" id="errocpf">
                    <label for="cpf">CPF:</label>
                    <input type="text" id="cpf" name="cpf"><br>
                </div>

                <div class="campo" id="erronovasenha">
                    <label for="novasenha">Nova Senha:</label>
                    <input type="password" id="novasenha" name="senha">
                </div>
                
                <div class="campo" id="erronovasenhaconf">
                    <label for="confnovasenha">Confirmar Nova Senha:</label>
                    <input type="password" id="confnovasenha" name="confsenha"><br>
                </div>
                
                <div class="campo" id="errotel">
                    <label for="telefone">Telefone:</label>
                    <input type="tel" id="telefone" name="telefone">
                </div>

                <div class="botoes">
                    <!-- <input type="button" name="reset" value="Reset" class="botao" onclick="resetar()"> -->

                    <button onclick="editar()"> Confirmar </button>
                    <div id="errogeral"></div>
                </div>
                

        </form>
        <div>
            <h1>Zona Perigosa</h1>
            <button name="excluir" class="botao" onclick="deletarConta()">Excluir conta</button>
        </div>

    </body>
    
</html>